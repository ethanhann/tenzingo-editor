"use strict";angular.module("eehJquery",[]).factory("eehJquery",function(){return window.jQuery}),angular.module("eehMarkdown",[]).factory("eehMarkdown",function(){return window.marked.setOptions({renderer:new window.marked.Renderer,gfm:!0,tables:!0,breaks:!0}),window.marked.setOptions({highlight:function(a){return window.hljs.highlightAuto(a).value}}),window.marked}),angular.module("eehEditor",["eehMarkdown"]).directive("eehEditor",["$anchorScroll","$location","$sce","$timeout","eehMarkdown",function(a,b,c,d,e){return{restrict:"AE",templateUrl:"views/eeh-editor.html",link:function(a,b){function c(a){return"undefined"!=typeof a[0].scrollHeight?a[0].scrollHeight:"undefined"!=typeof a.find("html")[0].scrollHeight&&0!==a.find("html")[0].scrollHeight?a.find("html")[0].scrollHeight:a.find("body")[0].scrollHeight}a.buildPreview=function(){b.find(".preview").empty().append(e(a.editor.getValue()))},a.$on("sync-preview:scroll",function(a,d){var e=b.find(".preview"),f=c(e);e.scrollTop(d*f)}),a.$watch("editorContent",function(){d(function(){angular.isUndefined(a.editor)||a.buildPreview()})})}}}]),angular.module("scrapsApp",["eehEditor","eehMarkdown","ngCookies","ngResource","ngSanitize","ngRoute","ui.ace"]),angular.module("scrapsApp").config(["$locationProvider","$routeProvider",function(a,b){a.html5Mode(!0),b.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",reloadOnSearch:!1}).otherwise({redirectTo:"/"})}]),angular.module("scrapsApp").controller("MainCtrl",["$anchorScroll","$location","$scope","eehMarkdown","$timeout",function(a,b,c,d,e){function f(){function a(a,b){var c="hr"===a[0].type,d=angular.isDefined(a[0].text)&&angular.isArray(a[0].text.match(/==[=]+/)),e=0===b;return(c||d)&&!e}function b(a){var b=0===h.length,d=a+1>=c.editor.session.getLength();return!b&&!d}var e=c.editor.session,f=c.selection.getCursor().row,h=e.getLine(f).trim(),k=d.lexer(h);if(angular.isDefined(k[0])&&"heading"===k[0].type)return void(angular.isDefined(k[0].text)&&i(j(k[0].text)));if(angular.isDefined(k[0])&&a(k,f)){var l=e.getLine(f-1).trim();if(l.length>0){if(f>=2&&e.getLine(f-2).trim().length>0)return;i(j(l))}}else{if(angular.isDefined(k[0])&&b(f)){var m=e.getLine(f+1).trim(),n=d.lexer(m);if(0===n.length)return;if("hr"===n[0].type||angular.isString(n[0].text)&&angular.isArray(n[0].text.match(/==[=]+/)))return void i(j(h))}g()}}function g(){var a=c.editor.getSession().getLength(),b=c.editor.getFirstVisibleRow()/a,d=c.selection.getCursor().row,e=c.editor.session.getLength();b=d+50>=e?1:b,c.$broadcast("sync-preview:scroll",b)}function h(a){angular.isUndefined(c.editor)||angular.isUndefined(a)||c.editor.gotoLine(a+1,0,!1)}function i(c){b.hash(c),a()}function j(a){return angular.isString(a)?a.toLowerCase().replace(/[^\w]+/g,"-"):""}c.editorContent="# Tenzingo\nTenzingo is a [Markdown](http://daringfireball.net/projects/markdown/) editor created by [Ethan Hann](http://ethanhann.com).\n\n",c.editorContent+="## Text Editor\nTenzingo uses [Ace Editor](http://ace.c9.io/) which provides a variety of features, including syntax highlighting and search/replace functionality.\n\n",c.editorContent+="## Table of Contents\nTenzingo automatically generates a table of contents based on the headers in a document. When an item in the table is clicked the appropriate line in the editor is selected and the preview scrolls to the correct position.\n\n",c.editorContent+="## Preview\nTenzingo transforms Markdown into HTML as a document is created by leveraging [marked](https://github.com/chjj/marked).\n\n",c.aceLoaded=function(a){c.editor=a,c.editor.setValue(c.editorContent);var b=c.editor.getSession();b.on("changeScrollTop",g),c.selection=c.editor.getSelection(),c.selection.on("changeCursor",f),c.buildTableOfContents()},c.aceChanged=function(){},c.goToLine=function(a,b,c){var d=angular.element(a.target).attr("data-target");h(c?b-1:b),i(d)},c.$watch("editorContent",function(){e(function(){angular.isUndefined(c.editor)||c.buildTableOfContents()})}),c.buildTableOfContents=function(){c.tableOfContentsItems=[];for(var a=c.editor.session.getLength(),b=[],e=0;a>e;e++){var f=c.editor.session.getLine(e),g=d.lexer(f);angular.isDefined(g[0])&&"heading"===g[0].type&&angular.isDefined(g[0].text)&&c.tableOfContentsItems.push({line:e,text:g[0].text,level:g[0].depth,isTwoLineHeader:!1,dataTarget:""+j(g[0].text)}),angular.isDefined(b[0])&&angular.isDefined(g[0])&&("hr"===g[0].type?c.tableOfContentsItems.push({line:e,text:b[0].text,level:2,isTwoLineHeader:!0,dataTarget:""+j(b[0].text)}):angular.isString(g[0].text)&&angular.isArray(g[0].text.match(/==[=]+/))&&c.tableOfContentsItems.push({line:e,text:b[0].text,level:1,isTwoLineHeader:!0,dataTarget:""+j(b[0].text)})),b=g}}}]);