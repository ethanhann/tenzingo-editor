"use strict";angular.module("eehJquery",[]).factory("eehJquery",function(){return window.jQuery}),angular.module("eehMarkdown",[]).factory("eehMarkdown",function(){return window.marked.setOptions({renderer:new window.marked.Renderer,gfm:!0,tables:!0,breaks:!0}),window.marked.setOptions({highlight:function(a){return window.hljs.highlightAuto(a).value}}),window.marked}),angular.module("eehEditor",["eehMarkdown"]).directive("eehEditor",["$anchorScroll","$location","$sce","$timeout","eehMarkdown",function(a,b,c,d,e){return{restrict:"AE",templateUrl:"views/eeh-editor.html",scope:{codeMirrorContent:"=eehEditorContent",codeMirrorOptions:"=eehEditorOptions"},link:function(c,f){function g(a){function b(a,b){var c="hr"===a[0].type,d=angular.isDefined(a[0].text)&&angular.isArray(a[0].text.match(/==[=]+/)),e=0===b;return(c||d)&&!e}function c(a){var b=0===g.length,c=a+1>=d.lineCount();return!b&&!c}var d=a.getDoc(),f=d.getCursor("head").line,g=d.getLine(f).trim(),h=e.lexer(g);if(!angular.isUndefined(h[0])){if("heading"===h[0].type)return void(angular.isDefined(h[0].text)&&j(k(h[0].text)));if(b(h,f)){var i=d.getLine(f-1).trim();if(i.length>0){if(f>=2&&d.getLine(f-2).trim().length>0)return;j(k(i))}}else if(c(f)){var l=d.getLine(f+1).trim(),m=e.lexer(l);if(0===m.length)return;("hr"===m[0].type||angular.isString(m[0].text)&&angular.isArray(m[0].text.match(/==[=]+/)))&&j(k(g))}}}function h(){}function i(a){angular.isUndefined(l)||angular.isUndefined(a)||(l.setCursor(l.getDoc().lineCount()),l.setCursor(a))}function j(c){b.hash(c),a()}function k(a){return angular.isString(a)?a.toLowerCase().replace(/[^\w]+/g,"-"):""}var l;c.codemirrorLoaded=function(a){l=a,a.getDoc().setValue(c.codeMirrorContent),angular.forEach(c.codeMirrorOptions,function(b,c){a.setOption(c,b)}),a.on("scroll",h),a.on("cursorActivity",g)},c.goToLine=function(a,b,c){var d=angular.element(a.target).attr("data-target");i(c?b-1:b),j(d)},c.$watch("codeMirrorContent",function(){d(function(){angular.isUndefined(l)||(c.buildPreview(),c.buildTableOfContents())})}),c.buildTableOfContents=function(){c.tableOfContentsItems=[];for(var a=l.getDoc(),b=a.lineCount(),d=[],f=0;b>f;f++){var g=a.getLine(f),h=e.lexer(g);angular.isDefined(h[0])&&"heading"===h[0].type&&angular.isDefined(h[0].text)&&c.tableOfContentsItems.push({line:f,text:h[0].text,level:h[0].depth,isTwoLineHeader:!1,dataTarget:""+k(h[0].text)}),angular.isDefined(d[0])&&angular.isDefined(h[0])&&("hr"===h[0].type?c.tableOfContentsItems.push({line:f,text:d[0].text,level:2,isTwoLineHeader:!0,dataTarget:""+k(d[0].text)}):angular.isString(h[0].text)&&angular.isArray(h[0].text.match(/==[=]+/))&&c.tableOfContentsItems.push({line:f,text:d[0].text,level:1,isTwoLineHeader:!0,dataTarget:""+k(d[0].text)})),d=h}},c.buildPreview=function(){f.find(".preview").empty().append(e(l.getDoc().getValue()))}}}}]),angular.module("scrapsApp",["eehEditor","eehMarkdown","ngCookies","ngResource","ngSanitize","ngRoute","ui.codemirror"]),angular.module("scrapsApp").config(["$locationProvider","$routeProvider",function(a,b){a.html5Mode(!0),b.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",reloadOnSearch:!1}).otherwise({redirectTo:"/"})}]),angular.module("scrapsApp").controller("MainCtrl",["$scope",function(a){a.editorOptions={mode:"gfm",theme:"lesser-dark",styleActiveLine:!0,lineWrapping:!0,lineNumbers:!0,extraKeys:{Enter:"newlineAndIndentContinueMarkdownList"}},a.editorContent="# Tenzingo\nTenzingo is a [Markdown](http://daringfireball.net/projects/markdown/) editor created by [Ethan Hann](http://ethanhann.com).\n\n",a.editorContent+="## Text Editor\nThe editor uses [CodeMirror](http://codemirror.net/) which provides a variety of features, including syntax highlighting and search/replace functionality.\n\n",a.editorContent+="## Table of Contents\nTenzingo automatically generates a table of contents based on the headers in a document. When an item in the table is clicked the appropriate line in the editor is selected and the preview scrolls to the correct position.\n\n",a.editorContent+="## Preview\nTenzingo transforms Markdown into HTML as a document is created by leveraging [marked](https://github.com/chjj/marked).\n\n"}]);